<div>
  <h2>POC Multi-Uploader usando Chunk para la manipulacion de Archivos en Multipart As√≠ncrono (Angular 20)</h2>
  <p>Configuraci√≥n autom√°tica: PDFs ligeros, videos pesados, cualquier tama√±o ‚Ä¢ Multi-selecci√≥n simult√°nea</p>

  <!-- Zona de Drag & Drop -->
  <div
    (dragover)="onDragOver($event)"
    (dragleave)="onDragLeave($event)"
    (drop)="onDrop($event)"
    (click)="fileInput.click()">

    @if (files().length === 0) {
      <div>
        <div>
          @if (isDragOver()) {
            <span>üì•</span>
          } @else {
            <span>üìÅ</span>
          }
        </div>
        <div>
          @if (isDragOver()) {
            <span>¬°Suelta los archivos aqu√≠!</span>
          } @else {
            <span>Arrastra m√∫ltiples archivos aqu√≠</span>
          }
        </div>
        <div>
          o <span>haz clic para seleccionar m√∫ltiples archivos</span>
        </div>
        <div>
          Soporta cualquier tipo de archivo y tama√±o<br>
          PDF, Videos, Im√°genes, Documentos, etc.
        </div>
      </div>
    } @else {
      <div>
        <div>üìÇ {{ totalFiles() }} archivo(s) seleccionado(s)</div>
        <div>Progreso global: {{ globalProgress() }}%</div>
        <button (click)="clearFile($event)">Limpiar todo</button>
      </div>
    }
  </div>

  <!-- Input file oculto -->
  <input
    #fileInput
    type="file"
    multiple
    (change)="onFile($event)"
    style="display: none;" />

  <!-- Lista de archivos -->
  @if (files().length > 0) {
    <div style="margin-top: 20px;">
      <h3>Archivos ({{ completedFiles() }}/{{ totalFiles() }} completados)</h3>
      
      @for (file of files(); track file.fileName; let i = $index) {
        <div style="border: 1px solid #ccc; margin: 10px 0; padding: 15px; border-radius: 5px;">
          <!-- Header del archivo -->
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
            <div>
              <span>{{ getFileIcon(file.fileName) }}</span>
              <strong>{{ file.fileName }}</strong>
              <span>({{ humanSize(file.totalBytes) }})</span>
            </div>
            <button (click)="removeFile(i, $event)" style="color: red;">‚ùå</button>
          </div>

          <!-- Barra de progreso -->
          @if (file.percent > 0) {
            <div style="background: #f0f0f0; height: 10px; border-radius: 5px; margin: 10px 0;">
              <div 
                style="background: #4CAF50; height: 100%; border-radius: 5px; transition: width 0.3s;"
                [style.width.%]="file.percent">
              </div>
            </div>
            <div style="font-size: 12px; color: #666;">
              {{ file.percent }}% ‚Äî {{ humanSize(file.sentBytes) }} / {{ humanSize(file.totalBytes) }}
              @if (file.speedBps) {
                <span> ¬∑ {{ humanSize(file.speedBps) }}/s</span>
              }
              @if (file.etaSeconds) {
                <span> ¬∑ ETA: ~{{ file.etaSeconds | number:'1.0-0' }}s</span>
              }
            </div>
          }

          <!-- Estados -->
          <div style="margin-top: 10px;">
            @if (file.uploading) {
              <span style="color: blue;">üîÑ Subiendo...</span>
            } @else if (file.done) {
              <span style="color: green;">‚úÖ Completado</span>
            } @else if (file.error) {
              <span style="color: red;">‚ùå Error: {{ file.error }}</span>
            } @else {
              <span style="color: gray;">‚è≥ Pendiente</span>
            }
          </div>
        </div>
      }
    </div>
  }

  <!-- Controles globales -->
  @if (files().length > 0) {
    <div style="margin-top: 20px;">
      <button (click)="start()" [disabled]="!canStart()">Subir Todos</button>
      <button (click)="pause()" [disabled]="uploadingFiles() === 0">Pausar Todo</button>
      <button (click)="resume()" [disabled]="uploadingFiles() === 0">Reanudar Todo</button>
      <button (click)="cancel()" [disabled]="uploadingFiles() === 0">Cancelar Todo</button>
    </div>
  }

  <!-- Estad√≠sticas globales -->
  @if (files().length > 0) {
    <div style="margin-top: 20px; padding: 10px; background: #f9f9f9; border-radius: 5px;">
      <strong>Estad√≠sticas:</strong><br>
      üìÅ Total: {{ totalFiles() }} archivos<br>
      ‚úÖ Completados: {{ completedFiles() }}<br>
      üîÑ Subiendo: {{ uploadingFiles() }}<br>
      üìä Progreso global: {{ globalProgress() }}%
    </div>
  }
</div>
