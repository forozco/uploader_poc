<div>
  <h2>POC Uploader usando Chunk para la manipulacion de Archivos en Multipart As√≠ncrono (Angular 20)</h2>
  <p>Configuraci√≥n autom√°tica: PDFs ligeros, videos pesados, cualquier tama√±o</p>

  <!-- Zona de Drag & Drop -->
  <div
    (dragover)="onDragOver($event)"
    (dragleave)="onDragLeave($event)"
    (drop)="onDrop($event)"
    (click)="fileInput.click()">

    @if (!fileName()) {
      <div>
        <div>
          @if (isDragOver()) {
            <span>üì•</span>
          } @else {
            <span>üìÅ</span>
          }
        </div>
        <div>
          @if (isDragOver()) {
            <span>¬°Suelta el archivo aqu√≠!</span>
          } @else {
            <span>Arrastra tu archivo aqu√≠</span>
          }
        </div>
        <div>
          o <span>haz clic para seleccionar</span>
        </div>
        <div>
          Soporta cualquier tipo de archivo y tama√±o<br>
          PDF, Videos, Im√°genes, Documentos, etc.
        </div>
      </div>
    } @else {
      <div>
        <div>{{ getFileIcon(fileName()) }}</div>
        <div>{{ fileName() }}</div>
        <div>{{ humanSize(totalBytes()) }}</div>
        <button (click)="clearFile($event)">Cambiar archivo</button>
      </div>
    }
  </div>

  <!-- Input file oculto -->
  <input
    #fileInput
    type="file"
    (change)="onFile($event)"
    style="display: none;" />

  @if (fileName()) {
    <div>
      El sistema ajustar√° autom√°ticamente el tama√±o de chunks y concurrencia seg√∫n el peso del archivo
    </div>
  }

  @if (percent() > 0 && percent() < 100) {
    <div>
      Debug: {{ percent() }}% ‚Ä¢ {{ humanSize(sentBytes()) }}/{{ humanSize(totalBytes()) }}
      @if (speedBps()) {
        ‚Ä¢ {{ humanSize(speedBps()) }}/s
      }
      @if (etaSeconds()) {
        ‚Ä¢ ETA: {{ etaSeconds() | number:'1.0-0' }}s
      }
    </div>
  }

  @if (percent() > 0) {
    <div>
      <div [style.width.%]="percent()"></div>
    </div>
  }
  @if (percent() > 0) {
    <div>
      {{ percent() }}% ‚Äî {{ humanSize(sentBytes()) }} / {{ humanSize(totalBytes()) }}
      @if (speedBps()) {
        <span> ¬∑ {{ humanSize(speedBps()) }}/s</span>
      }
      @if (etaSeconds()) {
        <span> ¬∑ ETA: ~{{ etaSeconds() | number:'1.0-0' }}s</span>
      }
    </div>
  }

  <!-- Controles de subida -->
  <div>
    <button (click)="start()" [disabled]="!canStart()">Subir</button>
    <button (click)="pause()" [disabled]="!uploading() || paused()">Pausar</button>
    <button (click)="resume()" [disabled]="!paused()">Reanudar</button>
    <button (click)="cancel()" [disabled]="!uploading() && percent() === 0">Cancelar</button>
  </div>

  <!-- Estados de error y completado -->
  @if (error()) {
    <div>Error: {{ error() }}</div>
  }
  @if (done()) {
    <div>¬°Listo! Archivo ensamblado en el servidor.</div>
  }
</div>
